# libdatachannel-example

This project demonstrates a minimal integration between an application layer and a stub implementation of the [`libdatachannel`](https://github.com/paullouisageneau/libdatachannel) API. It is intended as a scaffold that can be extended with the real library on platforms such as Windows and Linux.

## Project Structure

- **CMakeLists.txt** – Configures the build, third-party stub library, application targets, and unit tests.
- **include/** – Public headers that expose the sample API.
- **src/** – Source files for the native and WebAssembly entry points plus the reusable `RTCConnection` wrapper.
- **third_party/libdatachannel/** – A lightweight stand-in for the real `libdatachannel` project so the scaffold builds in offline environments.
- **tests/** – Basic unit tests that exercise the wrapper.
- **tools/** – Helper scripts for native and WebAssembly builds.

## Building (Linux/macOS)

```bash
cmake -S . -B build
cmake --build build
ctest --test-dir build
```

The native executable is placed in `build/native_app`. Tests are executed with `ctest`.

## Building (Windows)

On Windows, the same commands can be executed from a Visual Studio Developer Prompt or a PowerShell session configured for CMake. Alternatively, open the `build` directory generated by the configuration step in Visual Studio.

## Running the Native Peer-to-Peer Demo

The `native_app` executable can establish a local WebRTC data channel between two processes without any external signaling server.

1. Build the project and locate the `native_app` executable in your build directory (for example `build/native_app`).
2. In a terminal, start the offerer process:

   ```bash
   ./native_app --role offer --signal-dir ./signals
   ```

   This writes signaling information to `./signals/offer.txt`.

3. In a second terminal, start the answerer with the same signaling directory:

   ```bash
   ./native_app --role answer --signal-dir ./signals
   ```

4. Once the data channel is open, type messages in either terminal and press Enter to send them. Use `/exit` to terminate a process.

Using the same directory allows both processes to exchange SDP descriptions and ICE candidates through the local file system. This setup is convenient for validating native-to-native communication before integrating browser-based peers.

## Using the Browser Answerer

The repository includes a lightweight browser UI that can act as the answerer when the native application plays the offer role.

1. Start the native demo as the offerer and point it to a directory that the browser can read (for example by serving it through a simple HTTP file server).
2. Build the WebAssembly target (`ENABLE_WASM=ON`) so that `wasm_app.js`/`wasm_app.wasm` are produced. Copy those artifacts next to `examples/web_answer.html` under `examples/wasm/` (the UI expects them there when loading the libdatachannel runtime).
3. Open `examples/web_answer.html` in a browser. Paste the contents of the native `offer.txt` file into the *Offer From Native* textarea and click **Apply Offer**.
4. Copy the generated text from the *Generated Answer* panel and save it as `answer.txt` alongside the native signaling files.
5. If new `candidate:` lines appear in `offer.txt`, paste the updated contents and click **Apply Offer** again so the browser can import the additional ICE candidates.
6. Once the data channel is open you can exchange messages between the browser and the native process using the messaging panel.

The page mirrors the signaling file format used by the native demo (`type`, `sdp-begin`/`sdp-end`, and `candidate` lines), so no additional translation step is required.

## Building the WebAssembly Demo

To produce the WebAssembly executable, enable the `ENABLE_WASM` option with an Emscripten toolchain configured in your environment:

```bash
cmake -S . -B build-wasm -DENABLE_WASM=ON -DCMAKE_TOOLCHAIN_FILE=/path/to/emscripten/toolchain.cmake
cmake --build build-wasm
```

## Replacing the Stub Library

The scaffold uses a small in-tree stub of `libdatachannel` so that it can be built without network access. To integrate the real dependency:

1. Remove the `third_party/libdatachannel` directory.
2. Add the official project as a submodule or external dependency.
3. Update the `add_subdirectory` call in `CMakeLists.txt` to point at the real source.

## License

This project is distributed under the MIT License.

