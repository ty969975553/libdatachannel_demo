<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>WebRTC Answer (Web ↔ Native)</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            color: #222;
        }
        header, footer {
            background: #20232a;
            color: #fff;
            padding: 1rem 1.5rem;
        }
        main {
            padding: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        section {
            background: #fff;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
        h1, h2 {
            margin-top: 0;
        }
        textarea {
            width: 100%;
            min-height: 180px;
            resize: vertical;
            font-family: "Fira Code", monospace;
            padding: 0.5rem;
        }
        button {
            cursor: pointer;
            padding: 0.5rem 0.85rem;
            border-radius: 4px;
            border: 1px solid #3949ab;
            background: #3f51b5;
            color: #fff;
            font-weight: 600;
            transition: background 0.2s ease;
        }
        button:hover:not(:disabled) {
            background: #303f9f;
        }
        button:disabled {
            background: #9fa8da;
            cursor: not-allowed;
        }
        .row {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .status {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .status-item {
            background: #eef2ff;
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            font-size: 0.95rem;
        }
        .log {
            background: #0d1117;
            color: #c9d1d9;
            border-radius: 6px;
            padding: 0.75rem;
            font-family: "Fira Code", monospace;
            height: 220px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .messages {
            display: grid;
            grid-template-rows: auto auto;
            gap: 0.75rem;
        }
        .message-input {
            display: flex;
            gap: 0.5rem;
        }
        .message-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            color: #2e7d32;
            border-radius: 999px;
            padding: 0.15rem 0.6rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .badge.error {
            background: #ffebee;
            border-color: #ef9a9a;
            color: #c62828;
        }
        ul {
            padding-left: 1.2rem;
        }
        code {
            background: rgba(27, 31, 35, 0.08);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <h1>WebRTC Answer (Browser ↔ Native)</h1>
        <p>Paste the native <code>offer.txt</code> contents, generate the answer, and copy the resulting <code>answer.txt</code> back to the native signaling folder.</p>
    </header>
    <main>
        <section>
            <h2>Offer From Native</h2>
            <p>Paste the entire contents of <code>offer.txt</code> below, then click <strong>Apply Offer</strong>.</p>
            <textarea id="offerInput" placeholder="type:offer&#10;sdp-begin&#10;..."></textarea>
            <div class="row">
                <button id="applyOffer">Apply Offer</button>
                <span id="offerStatus" class="badge">Waiting for offer…</span>
            </div>
            <p>The native application may append new <code>candidate:</code> lines over time. Paste the updated file and click <strong>Apply Offer</strong> again to import additional ICE candidates.</p>
        </section>
        <section>
            <h2>Generated Answer</h2>
            <p>The text below follows the same format as the native signaling files. Save it as <code>answer.txt</code> in the shared signaling directory.</p>
            <textarea id="answerOutput" readonly placeholder="type:answer&#10;sdp-begin&#10;..."></textarea>
            <div class="status">
                <div class="status-item" id="descriptionStatus">Local description: <span class="badge error">not created</span></div>
                <div class="status-item" id="candidateStatus">ICE candidates gathered: <span class="badge">0</span></div>
            </div>
        </section>
        <section>
            <h2>Data Channel</h2>
            <div class="messages">
                <div class="log" id="messageLog"></div>
                <div class="message-input">
                    <input type="text" id="messageInput" placeholder="Type a message to send" disabled />
                    <button id="sendMessage" disabled>Send</button>
                </div>
            </div>
        </section>
        <section>
            <h2>Connection Log</h2>
            <div class="log" id="eventLog"></div>
        </section>
    </main>
    <footer>
        <p>Steps:</p>
        <ul>
            <li>Launch the native demo as <code>--role offer</code> and share the signaling folder via HTTP or manual copy.</li>
            <li>Paste the contents of <code>offer.txt</code> here and apply it.</li>
            <li>Copy the generated answer to <code>answer.txt</code> for the native application.</li>
            <li>Repeat offer import if new ICE candidates appear.</li>
        </ul>
    </footer>
    <script type="module" src="./web_answer.js"></script>
</body>
</html>
